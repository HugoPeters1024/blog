Rediscovering haskell's state monad from scratch