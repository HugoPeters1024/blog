{% extends "templates/post.html" %}

{% block post %}

<h2>Preface: A game and its rules</h2>
<i>
<p>
"Given a chessboard and a knight, can you find a path that will cover each cell once and exactly
once? If you are able to do so faster than me you stand to win a fortune." 
<p>- The prince of Hamilton</p>
<p>P.S. </p>

<p>
Don't tell my dad I gamble for money</i>
</p>

<h2>Chapter 1: An impatient knight</h2>
<p>
A long time ago, in the old country of Hamilton we find a young, brave man riding a horse.
Conflicted between the thrill of becoming an independent man and the distress of being
sent away by his family, confidently traverses the various terrains towards the royal palace.
</p>

<p>
As the sun went down, our protagonist decided to take shelter in a small cabin. Although the 
cabin was made of simple wooden logs, the ingenious structure suggested an owner that is smarter
than most of its kind. The entrance was a small space between two life size, wooden statues of
a king and queen as found on a chessboard. Inside, the floor was made of black and white tiles.
One of walls had a poem on it: <i>If shadow and light is a line you do not believe in,
  add up down to left right and see if it is even.</i>
<p>

<p>
As part of the payment for the overnight stay, the knight promised the isolated cabin owner to
humor him with his life story. Next to the fireplace, accompanied by a pot of strong black
coffee, the knight began: "As all boys in my family I am to leave my home at the age of 18, not
to return until I have made my own fortune. This is the fate that my father and his fathers
before him have suffered and been molded by." "And how will you, suffering young man, make
your fortune?" the cabin owner asked. The knight proudly raised his chin and announced: "I will
challenge the prince to a Knight's Tour. It is widely known that the winner is greatly rewarded."
The cabin owner made a concerned face and asked: "Does the prize constitute an object on the
first cell of chessboard, double on the second and so forth?" Slightly rattled by the very
specific question the knight refuted that price would be a constant sum of money.
</p>

<p>
As the conversation progresses the knight became more and more insecure. It was only now, when
forced to formulate his ideas into words and sentences that he realized how unprepared he was.
The cabin owner noticed his realization, took pity in his situation, and decided to help him.
"Long ago, I was a student of pure mathematics and worked on the Knight's Tour problem 
for very long." He compassionately hands the knight 
<a href="https://doi.org/10.1016/0166-218X(92)00170-Q" target="_blank">a document.</a>.
"It is very technical so please take your time to study it carefully." 
</p>

<p>
But the words of the cabin owner would fall on deaf ears as the knight quickly browsed through
all the pages. Back in his room, under the light of a dying candle, he read the following
fact: <i>for an 8x8 chessboard there are 26,534,728,821,064 ways to complete a tour.</i> "What
an incomprehensible gargantuan number!" the knight thought to himself. "I will go to the prince
and challenge him, with so many solutions it is only a matter of chance until my guess beats
his, skill does not defeat probability!"
</p>

<p>
The cabin owner found himself being not at all surprised as he stumbled upon an empty bed that
morning. The same bed the knight, contrary to most other days, was not thinking about as he
galloped his horse onto the palace grounds. He tied his horse to the pole next to a small
fountain; the animal gratefully indulged. At the main gate a bishop was reading a small
bible in the shade. The knight politely asked him where he may find the Prince of Hamilton. 
<i>"God does not play dice, and man should not either."</i> the bishop answered disapprovingly,
as he pointed diagonally towards the field next to the royal garden. 
</p>

<p>
The prince was lying on his back, looking at the clouds. His head swiftly lifted up as he heard
the knight's footsteps approaching. Both of them knew why they were there. 
</p>

<p>
Our Knight would later vividly recall the humiliating situation that took place in the
garden. He and the prince started on opposite corners of a 6x6 chessboard, a board size 
normally reserved for children. Regardless, our knight simply hopped in any random direction,
constantly finding himself stuck on a cell without having visited all of them. In his distress
he did not notice that the prince, somewhat similarly, is not completing the tour without 
stopping sometimes, but he then retraces a few steps before proceeding instead of
starting all over again. With tears of shame and anger burning behind his eyes, 
the knight returned to the cabin.
</p>

<div class="window">
<div class="panel">
  {% call macros.code('python') %}
    import random

    def tryRandom() -> int:
        w=6
        h=6
        # Create an empty board
        board = [0] * (w * h)
        (px, py) = (0,0)
        move_count = 0
        while True:
            move_count += 1
            board[px + w * py] = move_count
            # Filter moves that do not exit
            # the board and go to a non visited cell 
            validMoves = []
            for (dx, dy) in getMoves():
                nx = px + dx
                ny = py + dy
                if nx >= 0 and \
                   nx <  w and \
                   ny >= 0 and \ 
                   ny <  h and \
                   board[nx + w * ny] == 0:
                    validMoves.append((nx, ny))

            # No more valid moves, stop
            if len(validMoves) == 0:
                return move_count

            # Do one of the possible moves at random
            (px, py) = random.choice(validMoves)

    def getMoves():
        return [(2, 1), (2, -1), (-2, 1), (-2, -1),
                (1, 2), (1, -2), (-1, 2), (-1, -2)]
  {% endcall %}
</div>
  <div class="panel">
  <figure>
    <img src="random_move.png" alt="distribution plot of moves until blocked when randomly
    choosen" style="max-width:100%">
    <figcaption>Fig.1 - Distribution plot of the number of moves made before he  
      knight was stuck. When any of these numbers would have been 36, the knight would have
      completed a tour.</figcaption>
  </figure>
</div>
</div>


<h2>Chapter 2: We must go deeper</h2>
<p>
  The cabin owner, although truly feeling compassion towards the knight, also
  felt content with knowing the knight would be around for a while. The next day
  he took the knight out for a walk in the nearby forest. He pointed at the trees
  and with a soft voice started to describe how the each branch itself looks like
  a three, albeit smaller. Symptomatic of overcoming his latest brush with defeat,
  the knight started to climb up in one of the trees. Although not fully realizing
  the meaning behind the cabin owner's words, he appreciated the insight and felt
  it ought to be meaningful someday.
</p>

<p>
  That evening, the cabin owner showed the knight a different puzzle, a maze to
  be precise. "Neither my mind nor my writing hand has the endurance to work out
  such a large maze!" the knight screamed. With a grin the cabin owner answered:
  "Good, now that we have established that, we can think of a way to do this better."
  The cabin owner reached in a cabinet and took out a robust laptop with a mechanical 
  keyboard. "Perhaps we can just focus on a way to think about how to solve it and leave
  the actual calculations to the computer," the cabin owner proposed.
</p>

<p>
  After hours of puzzling the knight was now completely familiar with the concept
  of <a href="https://en.wikipedia.org/wiki/Depth-first_search">'Depth First Search'</a>.
  "It is just like the trees in the forest!" the knight yelled euphorically. Inside
  the knights head the cogs started turning.. "Well if you have a chessboard, each cell
  marked with the order of visiting it, or a 0 if it has never been visited, than we can
  consider each possible move a sub three of that 'node'! The prince did not say anything
  about using computers, I can simply program this out and let the computer find the solution!"
</p>

<div class="window">
  <div class="panel">
    {% call macros.code('python') %}
    def printBoard(board, w, h):
        for y in range(h):
            for x in range(w):
                print(f"{board[x + w * y]}\t", end='')
            print()


    def isValid(board, w, h, pos):
        (x, y) = pos
        return x >= 0 and \
               x <  w and \
               y >= 0 and \
               y <  h and \
               board[x + w * y] == 0

    def getMoves():
        return [(2, 1), (2, -1), (-2, 1), (-2, -1),
                (1, 2), (1, -2), (-1, 2), (-1, -2)]


    def getSuccessors(board, w, h, pos, count):
        (px, py) = pos
        for (dx, dy) in getMoves():
            nx = px + dx
            ny = py + dy
            if isValid(board, w, h, (nx, ny)):
                new_board = board.copy()
                new_board[nx + w * ny] = count+1
                yield (new_board, (nx, ny), count+1)

    def findSolution(w, h, show=True):
        init_board = [0] * (w*h)
        init_board[0] = 1
        stack = [(init_board, (0,0), 1)]
        while len(stack) > 0:
            (board, pos, count) = stack.pop()
            # Check if the tour has been completed
            if count == w*h:
                if show:
                    printBoard(board, w, h)
                return
            # Add all possible successors 
            # to the top of the stack
            for succ in getSuccessors(board, w, h, pos, count):
                stack.append(succ)
        print("Solution does not exist")
    {% endcall %}
  </div>
  <div class="panel">
    <table class="rwd-table">
      <thead>
        <tr><th>Board Size</th><th>Seconds to Find a Solution</th></tr>
      </thead>
      <tbody>
      <tr><td>3x4</td><td>0.0000403919</td></tr>
      <tr><td>4x4</td><td>No solution</td></tr>
      <tr><td>4x5</td><td>0.002298420004080981</td></tr>
      <tr><td>5x5</td><td>0.01602805100264959</td></tr>
      <tr><td>5x6</td><td>0.05149075100780465</td></tr>
      <tr><td>6x6</td><td>39.208281058992725</td></tr>
      </tbody>
    </table>

    {% call macros.code('sh') %}
    6x6 solution:
    1    12    31    34    19    36
    30   5     18    11    28    33
    13   2     29    32    35    20
    6    23    4     17    10    27
    3    14    25    8     21    16
    24   7     22    15    26    9
    {% endcall %}

  </div>
</div>

<p>
Now without damaging his ego the knight was now able to see that victory was not yet in
sight. The cabin owner had taught him to call the devil by his name 'exponential complexity'.
Not only did he remember that the prince was able to solve the 6 by 6 board much faster
than 39 seconds, he also knew that the 6 by 6 was merely a warm up. However, following
the exponential curve it would seem that solving tour on boards larger than that would
take minutes and quickly hours or days.
</p>




{% endblock %}
